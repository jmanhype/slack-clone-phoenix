defmodule SlackCloneWeb.EmojiPickerComponent do
  use SlackCloneWeb, :live_component
  
  @emoji_categories [
    %{name: "Frequently used", key: "frequent", emojis: ["ğŸ˜€", "ğŸ˜‚", "ğŸ‘", "â¤ï¸", "ğŸ˜", "ğŸ”¥", "ğŸ‘", "ğŸ‰"]},
    %{name: "People", key: "people", emojis: ["ğŸ˜€", "ğŸ˜ƒ", "ğŸ˜„", "ğŸ˜", "ğŸ˜†", "ğŸ˜…", "ğŸ¤£", "ğŸ˜‚", "ğŸ™‚", "ğŸ™ƒ", "ğŸ˜‰", "ğŸ˜Š", "ğŸ˜‡", "ğŸ˜", "ğŸ¤©", "ğŸ˜˜", "ğŸ˜—", "ğŸ˜š", "ğŸ˜™", "ğŸ˜‹", "ğŸ˜›", "ğŸ˜œ", "ğŸ¤ª", "ğŸ˜", "ğŸ¤‘", "ğŸ¤—", "ğŸ¤­", "ğŸ¤«", "ğŸ¤”", "ğŸ¤", "ğŸ¤¨", "ğŸ˜", "ğŸ˜‘", "ğŸ˜¶", "ğŸ˜", "ğŸ˜’", "ğŸ™„", "ğŸ˜¬", "ğŸ¤¥", "ğŸ˜”", "ğŸ˜ª", "ğŸ¤¤", "ğŸ˜´", "ğŸ˜·", "ğŸ¤’", "ğŸ¤•", "ğŸ¤¢", "ğŸ¤®", "ğŸ¤§", "ğŸ˜µ", "ğŸ¤¯", "ğŸ¤ ", "ğŸ˜", "ğŸ¤“", "ğŸ§"]},
    %{name: "Nature", key: "nature", emojis: ["ğŸ¶", "ğŸ±", "ğŸ­", "ğŸ¹", "ğŸ°", "ğŸ¦Š", "ğŸ»", "ğŸ¼", "ğŸ¨", "ğŸ¯", "ğŸ¦", "ğŸ®", "ğŸ·", "ğŸ½", "ğŸ¸", "ğŸµ", "ğŸ™ˆ", "ğŸ™‰", "ğŸ™Š", "ğŸ’", "ğŸ”", "ğŸ§", "ğŸ¦", "ğŸ¤", "ğŸ£", "ğŸ¥", "ğŸ¦†", "ğŸ¦…", "ğŸ¦‰", "ğŸ¦‡", "ğŸº", "ğŸ—", "ğŸ´", "ğŸ¦„", "ğŸ", "ğŸ›", "ğŸ¦‹", "ğŸŒ", "ğŸ", "ğŸœ", "ğŸ¦—", "ğŸ•·", "ğŸ¦‚", "ğŸ¢", "ğŸ", "ğŸ¦", "ğŸ¦–", "ğŸ¦•", "ğŸ™", "ğŸ¦‘", "ğŸ¦", "ğŸ¦", "ğŸ¦€", "ğŸ¡", "ğŸ ", "ğŸŸ", "ğŸ¬", "ğŸ³", "ğŸ‹", "ğŸ¦ˆ", "ğŸŠ", "ğŸ…", "ğŸ†", "ğŸ¦“", "ğŸ¦", "ğŸ˜", "ğŸ¦", "ğŸª", "ğŸ«", "ğŸ¦’", "ğŸƒ", "ğŸ‚", "ğŸ„", "ğŸ", "ğŸ–", "ğŸ", "ğŸ‘", "ğŸ", "ğŸ¦Œ", "ğŸ•", "ğŸ©", "ğŸˆ", "ğŸ“", "ğŸ¦ƒ", "ğŸ•Š", "ğŸ‡", "ğŸ", "ğŸ€", "ğŸ¿", "ğŸ¦”"]},
    %{name: "Food", key: "food", emojis: ["ğŸ", "ğŸ", "ğŸ", "ğŸŠ", "ğŸ‹", "ğŸŒ", "ğŸ‰", "ğŸ‡", "ğŸ“", "ğŸˆ", "ğŸ’", "ğŸ‘", "ğŸ", "ğŸ¥­", "ğŸ¥¥", "ğŸ¥", "ğŸ…", "ğŸ†", "ğŸ¥‘", "ğŸ¥¦", "ğŸ¥•", "ğŸŒ½", "ğŸŒ¶", "ğŸ¥’", "ğŸ¥¬", "ğŸ¥–", "ğŸ", "ğŸ¥¨", "ğŸ¥¯", "ğŸ§€", "ğŸ¥š", "ğŸ³", "ğŸ¥", "ğŸ¥“", "ğŸ¥©", "ğŸ—", "ğŸ–", "ğŸŒ­", "ğŸ”", "ğŸŸ", "ğŸ•", "ğŸŒ®", "ğŸŒ¯", "ğŸ¥™", "ğŸ¥—", "ğŸ¥˜", "ğŸ¥«", "ğŸ", "ğŸœ", "ğŸ²", "ğŸ›", "ğŸ£", "ğŸ±", "ğŸ¥Ÿ", "ğŸ¤", "ğŸ™", "ğŸš", "ğŸ˜", "ğŸ¥", "ğŸ¥ ", "ğŸ¢", "ğŸ¡", "ğŸ§", "ğŸ¨", "ğŸ¦", "ğŸ¥§", "ğŸ°", "ğŸ‚", "ğŸ®", "ğŸ­", "ğŸ¬", "ğŸ«", "ğŸ¿", "ğŸ©", "ğŸª", "ğŸŒ°", "ğŸ¥œ", "ğŸ¯"]},
    %{name: "Activity", key: "activity", emojis: ["âš½", "ğŸ€", "ğŸˆ", "âš¾", "ğŸ¾", "ğŸ", "ğŸ‰", "ğŸ±", "ğŸ“", "ğŸ¸", "ğŸ¥…", "ğŸ’", "ğŸ‘", "ğŸ¥", "ğŸ", "â›³", "ğŸ¹", "ğŸ£", "ğŸ¥Š", "ğŸ¥‹", "ğŸ½", "â›¸", "ğŸ¥Œ", "ğŸ›·", "ğŸ¿", "â›·", "ğŸ‚", "ğŸ‹", "ğŸ¤¼", "ğŸ¤¸", "â›¹", "ğŸ¤º", "ğŸ‡", "ğŸ§˜", "ğŸ„", "ğŸŠ", "ğŸ¤½", "ğŸš£", "ğŸ§—", "ğŸš´", "ğŸšµ", "ğŸ†", "ğŸ¥‡", "ğŸ¥ˆ", "ğŸ¥‰", "ğŸ…", "ğŸ–", "ğŸµ", "ğŸ—", "ğŸ«", "ğŸŸ", "ğŸª", "ğŸ¤¹", "ğŸ­", "ğŸ¨", "ğŸ¬", "ğŸ¤", "ğŸ§", "ğŸ¼", "ğŸ¹", "ğŸ¥", "ğŸ·", "ğŸº", "ğŸ¸", "ğŸ»", "ğŸ²", "ğŸ¯", "ğŸ³", "ğŸ®", "ğŸ°"]},
    %{name: "Travel", key: "travel", emojis: ["ğŸš—", "ğŸš•", "ğŸš™", "ğŸšŒ", "ğŸš", "ğŸ", "ğŸš“", "ğŸš‘", "ğŸš’", "ğŸš", "ğŸšš", "ğŸš›", "ğŸšœ", "ğŸ", "ğŸš²", "ğŸ›´", "ğŸ›¹", "ğŸš", "ğŸšŸ", "ğŸš ", "ğŸš¡", "ğŸš‚", "ğŸšƒ", "ğŸš„", "ğŸš…", "ğŸš†", "ğŸš‡", "ğŸšˆ", "ğŸš‰", "ğŸšŠ", "ğŸš", "ğŸš", "ğŸš‹", "ğŸšƒ", "ğŸš–", "ğŸš˜", "ğŸš", "ğŸš”", "ğŸš¨", "ğŸšª", "ğŸš§", "â›½", "ğŸš¥", "ğŸš¦", "ğŸ›£", "ğŸ—º", "ğŸ—¿", "ğŸ—½", "ğŸ—¼", "ğŸ°", "ğŸ¯", "ğŸŸ", "ğŸ¡", "ğŸ¢", "ğŸ ", "â›±", "ğŸ–", "ğŸ", "ğŸœ", "ğŸŒ‹", "â›°", "ğŸ”", "ğŸ—»", "ğŸ•", "â›º", "ğŸ ", "ğŸ¡", "ğŸ˜", "ğŸš", "ğŸ—", "ğŸ­", "ğŸ¢", "ğŸ¬", "ğŸ£", "ğŸ¤", "ğŸ¥", "ğŸ¦", "ğŸ¨", "ğŸª", "ğŸ«", "ğŸ©", "ğŸ’’", "ğŸ›", "â›ª", "ğŸ•Œ", "ğŸ•", "ğŸ•‹"]},
    %{name: "Objects", key: "objects", emojis: ["âŒš", "ğŸ“±", "ğŸ“²", "ğŸ’»", "âŒ¨", "ğŸ–¥", "ğŸ–¨", "ğŸ–±", "ğŸ–²", "ğŸ•¹", "ğŸ—œ", "ğŸ’½", "ğŸ’¾", "ğŸ’¿", "ğŸ“€", "ğŸ“¼", "ğŸ“·", "ğŸ“¸", "ğŸ“¹", "ğŸ¥", "ğŸ“½", "ğŸ", "ğŸ“", "â˜", "ğŸ“Ÿ", "ğŸ“ ", "ğŸ“º", "ğŸ“»", "ğŸ™", "ğŸš", "ğŸ›", "â±", "â²", "â°", "ğŸ•°", "âŒ›", "â³", "ğŸ“¡", "ğŸ”‹", "ğŸ”Œ", "ğŸ’¡", "ğŸ”¦", "ğŸ•¯", "ğŸ—‘", "ğŸ›¢", "ğŸ’¸", "ğŸ’µ", "ğŸ’´", "ğŸ’¶", "ğŸ’·", "ğŸ’°", "ğŸ’³", "ğŸ’", "âš–", "ğŸ”§", "ğŸ”¨", "âš’", "ğŸ› ", "â›", "ğŸ”©", "âš™", "â›“", "ğŸ”«", "ğŸ’£", "ğŸ”ª", "ğŸ—¡", "âš”", "ğŸ›¡", "ğŸš¬", "âš°", "âš±", "ğŸº", "ğŸ“¿", "ğŸ’ˆ", "âš—", "ğŸ”­", "ğŸ”¬", "ğŸ•³", "ğŸ’Š", "ğŸ’‰", "ğŸŒ¡", "ğŸš½", "ğŸš°", "ğŸš¿", "ğŸ›", "ğŸ›€", "ğŸ›", "ğŸ”‘", "ğŸ—", "ğŸšª", "ğŸ›‹", "ğŸ›", "ğŸ›Œ", "ğŸ–¼", "ğŸ›", "ğŸ›’", "ğŸ", "ğŸˆ", "ğŸ", "ğŸ€", "ğŸŠ", "ğŸ‰", "ğŸ", "ğŸ®", "ğŸ", "ğŸ“©", "ğŸ“¨", "ğŸ“§", "ğŸ’Œ", "ğŸ“¥", "ğŸ“¤", "ğŸ“¦", "ğŸ·", "ğŸ“ª", "ğŸ“«", "ğŸ“¬", "ğŸ“­", "ğŸ“®", "ğŸ“¯", "ğŸ“œ", "ğŸ“ƒ", "ğŸ“„", "ğŸ“‘", "ğŸ“Š", "ğŸ“ˆ", "ğŸ“‰", "ğŸ—’", "ğŸ—“", "ğŸ“†", "ğŸ“…", "ğŸ“‡", "ğŸ—ƒ", "ğŸ—³", "ğŸ—„", "ğŸ“‹", "ğŸ“", "ğŸ“‚", "ğŸ—‚", "ğŸ—", "ğŸ“°", "ğŸ““", "ğŸ“”", "ğŸ“’", "ğŸ“•", "ğŸ“—", "ğŸ“˜", "ğŸ“™", "ğŸ“š", "ğŸ“–", "ğŸ”–", "ğŸ”—", "ğŸ“", "ğŸ–‡", "ğŸ“", "ğŸ“", "ğŸ“Œ", "ğŸ“", "âœ‚", "ğŸ–Š", "ğŸ–‹", "âœ’", "ğŸ–Œ", "ğŸ–", "ğŸ“", "âœ", "ğŸ”", "ğŸ”", "ğŸ”", "ğŸ”", "ğŸ”’", "ğŸ”“"]},
    %{name: "Symbols", key: "symbols", emojis: ["â¤", "ğŸ§¡", "ğŸ’›", "ğŸ’š", "ğŸ’™", "ğŸ’œ", "ğŸ–¤", "ğŸ’”", "â£", "ğŸ’•", "ğŸ’", "ğŸ’“", "ğŸ’—", "ğŸ’–", "ğŸ’˜", "ğŸ’", "ğŸ’Ÿ", "â˜®", "âœ", "â˜ª", "ğŸ•‰", "â˜¸", "âœ¡", "ğŸ”¯", "ğŸ•", "â˜¯", "â˜¦", "ğŸ›", "â›", "â™ˆ", "â™‰", "â™Š", "â™‹", "â™Œ", "â™", "â™", "â™", "â™", "â™‘", "â™’", "â™“", "ğŸ†”", "âš›", "ğŸ‰‘", "â˜¢", "â˜£", "ğŸ“´", "ğŸ“³", "ğŸˆ¶", "ğŸˆš", "ğŸˆ¸", "ğŸˆº", "ğŸˆ·", "âœ´", "ğŸ†š", "ğŸ’®", "ğŸ‰", "ãŠ™", "ãŠ—", "ğŸˆ´", "ğŸˆµ", "ğŸˆ¹", "ğŸˆ²", "ğŸ…°", "ğŸ…±", "ğŸ†", "ğŸ†‘", "ğŸ…¾", "ğŸ†˜", "âŒ", "â­•", "ğŸ›‘", "â›”", "ğŸ“›", "ğŸš«", "ğŸ’¯", "ğŸ’¢", "â™¨", "ğŸš·", "ğŸš¯", "ğŸš³", "ğŸš±", "ğŸ”", "ğŸ“µ", "ğŸš­", "â—", "â•", "â“", "â”", "â€¼", "â‰", "ğŸ”…", "ğŸ”†", "ã€½", "âš ", "ğŸš¸", "ğŸ”±", "âšœ", "ğŸ”°", "â™»", "âœ…", "ğŸˆ¯", "ğŸ’¹", "â‡", "âœ³", "â", "ğŸŒ", "ğŸ’ ", "â“‚", "ğŸŒ€", "ğŸ’¤", "ğŸ§", "ğŸš¾", "â™¿", "ğŸ…¿", "ğŸˆ³", "ğŸˆ‚", "ğŸ›‚", "ğŸ›ƒ", "ğŸ›„", "ğŸ›…", "ğŸš¹", "ğŸšº", "ğŸš¼", "ğŸš»", "ğŸš®", "ğŸ¦", "ğŸ“¶", "ğŸˆ", "ğŸ”£", "â„¹", "ğŸ”¤", "ğŸ”¡", "ğŸ” ", "ğŸ†–", "ğŸ†—", "ğŸ†™", "ğŸ†’", "ğŸ†•", "ğŸ†“", "0âƒ£", "1âƒ£", "2âƒ£", "3âƒ£", "4âƒ£", "5âƒ£", "6âƒ£", "7âƒ£", "8âƒ£", "9âƒ£", "ğŸ”Ÿ", "ğŸ”¢", "#âƒ£", "*âƒ£", "â", "â–¶", "â¸", "â¯", "â¹", "âº", "â­", "â®", "â©", "âª", "â«", "â¬", "â—€", "ğŸ”¼", "ğŸ”½", "â¡", "â¬…", "â¬†", "â¬‡", "â†—", "â†˜", "â†™", "â†–", "â†•", "â†”", "â†ª", "â†©", "â¤´", "â¤µ", "ğŸ”€", "ğŸ”", "ğŸ”‚", "ğŸ”„", "ğŸ”ƒ", "ğŸµ", "ğŸ¶", "â•", "â–", "â—", "âœ–", "ğŸ’²", "ğŸ’±", "â„¢", "Â©", "Â®", "ã€°", "â°", "â¿", "ğŸ”š", "ğŸ”™", "ğŸ”›", "ğŸ”", "ğŸ”œ", "âœ”", "â˜‘", "ğŸ”˜", "âšª", "âš«", "ğŸ”´", "ğŸ”µ", "ğŸ”º", "ğŸ”»", "ğŸ”¸", "ğŸ”¹", "ğŸ”¶", "ğŸ”·", "ğŸ”³", "ğŸ”²", "â–ª", "â–«", "â¬›", "â¬œ", "ğŸ”ˆ", "ğŸ”‡", "ğŸ”‰", "ğŸ”Š", "ğŸ””", "ğŸ”•", "ğŸ“£", "ğŸ“¢", "ğŸ‘â€ğŸ—¨", "ğŸ’¬", "ğŸ’­", "ğŸ—¯", "â™ ", "â™£", "â™¥", "â™¦", "ğŸƒ", "ğŸ´", "ğŸ€„", "ğŸ•", "ğŸ•‘", "ğŸ•’", "ğŸ•“", "ğŸ•”", "ğŸ••", "ğŸ•–", "ğŸ•—", "ğŸ•˜", "ğŸ•™", "ğŸ•š", "ğŸ•›", "ğŸ•œ", "ğŸ•", "ğŸ•", "ğŸ•Ÿ", "ğŸ• ", "ğŸ•¡", "ğŸ•¢", "ğŸ•£", "ğŸ•¤", "ğŸ•¥", "ğŸ•¦", "ğŸ•§"]}
  ]
  
  @impl true
  def render(assigns) do
    ~H"""
    <div class="h-full flex flex-col">
      <!-- Search -->
      <div class="p-3 border-b border-slack-border">
        <input 
          type="text" 
          placeholder="Search emojis..."
          class="w-full px-3 py-2 text-sm border border-slack-border rounded focus:outline-none focus:border-slack-blue"
          phx-target={@myself}
          phx-keyup="search_emojis"
        />
      </div>
      
      <!-- Categories -->
      <div class="flex border-b border-slack-border">
        <%= for category <- @emoji_categories do %>
          <button 
            class={[
              "flex-1 px-2 py-2 text-xs font-medium transition-colors",
              if(@active_category == category.key, 
                do: "text-slack-blue border-b-2 border-slack-blue", 
                else: "text-slack-text-muted hover:text-slack-text-primary"
              )
            ]}
            phx-click="switch_category"
            phx-value-category={category.key}
            phx-target={@myself}
          >
            {String.slice(category.name, 0, 1)}
          </button>
        <% end %>
      </div>
      
      <!-- Emoji Grid -->
      <div class="flex-1 overflow-y-auto p-2">
        <%= if @search_results do %>
          <!-- Search Results -->
          <div class="grid grid-cols-8 gap-1">
            <%= for emoji <- @search_results do %>
              <button 
                class="w-8 h-8 flex items-center justify-center text-lg hover:bg-slack-bg-secondary rounded transition-colors"
                phx-click="select_emoji"
                phx-value-emoji={emoji}
                phx-target={@target}
                title={emoji}
              >
                {emoji}
              </button>
            <% end %>
          </div>
        <% else %>
          <!-- Category View -->
          <%= for category <- @emoji_categories do %>
            <%= if @active_category == category.key do %>
              <div>
                <h4 class="text-xs font-medium text-slack-text-muted mb-2 uppercase tracking-wide px-1">
                  {category.name}
                </h4>
                <div class="grid grid-cols-8 gap-1 mb-4">
                  <%= for emoji <- category.emojis do %>
                    <button 
                      class="w-8 h-8 flex items-center justify-center text-lg hover:bg-slack-bg-secondary rounded transition-colors"
                      phx-click="select_emoji"
                      phx-value-emoji={emoji}
                      phx-target={@target}
                      title={emoji}
                    >
                      {emoji}
                    </button>
                  <% end %>
                </div>
              </div>
            <% end %>
          <% end %>
        <% end %>
      </div>
    </div>
    """
  end
  
  @impl true
  def update(assigns, socket) do
    {:ok,
     socket
     |> assign(assigns)
     |> assign_new(:active_category, fn -> "frequent" end)
     |> assign_new(:search_results, fn -> nil end)
     |> assign(:emoji_categories, @emoji_categories)}
  end
  
  @impl true
  def handle_event("switch_category", %{"category" => category}, socket) do
    {:noreply, 
     socket
     |> assign(:active_category, category)
     |> assign(:search_results, nil)}
  end
  
  @impl true
  def handle_event("search_emojis", %{"value" => query}, socket) do
    results = if String.trim(query) == "" do
      nil
    else
      query = String.downcase(query)
      
      @emoji_categories
      |> Enum.flat_map(& &1.emojis)
      |> Enum.filter(fn _emoji ->
        # Simple search - in a real app, you'd have emoji names/keywords
        String.contains?(query, String.slice(query, 0, 1))
      end)
      |> Enum.take(40)
    end
    
    {:noreply, assign(socket, :search_results, results)}
  end
end